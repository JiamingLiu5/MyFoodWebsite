<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Edit Post</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="container">
      <header class="page-header simple">
        <h1 class="brand-title">Edit Post</h1>
      </header>

      <% if (error) { %>
        <p class="upload-error"><%= error %></p>
      <% } %>

      <% if (entry.images && entry.images.length) { %>
        <article class="entry">
          <div class="entry-images <%= entry.images.length > 1 ? 'is-multi' : 'is-single' %>">
            <% entry.images.forEach(function(img) { %>
              <div class="editable-image">
                <a class="entry-image-link" href="<%= fileUrl(img.filename) %>" data-lightbox>
                  <img src="<%= fileUrl(img.filename) %>" alt="Current photo" />
                </a>
                <label class="remove-image-label">
                  <input type="checkbox" name="removeImageIds" value="<%= img.id %>" form="editPostForm" />
                  Remove this image
                </label>
              </div>
            <% }) %>
          </div>
        </article>
      <% } %>

      <form id="editPostForm" action="/entries/<%= entry.id %>/edit" method="post" enctype="multipart/form-data" class="upload-form">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
        <label>Add photos (optional, up to <%= maxImagesPerPost %> total)</label>
        <input type="file" name="photos" accept="image/*" multiple />
        <div class="upload-preview" id="uploadPreview" hidden>
          <img id="uploadPreviewImg" alt="Selected photo preview" />
          <div class="upload-preview-meta">
            <div id="uploadPreviewName"></div>
            <div id="uploadPreviewInfo"></div>
          </div>
        </div>
        <p id="uploadPreviewError" class="upload-preview-error" hidden></p>
        <% if (entry.images && entry.images.length) { %>
          <label><input type="checkbox" name="removeAllPhotos" /> Remove all existing photos</label>
        <% } %>
        <label>Note</label>
        <textarea name="note" rows="4" placeholder="Update your note..."><%= entry.note || '' %></textarea>
        <button type="submit">Save</button>
      </form>

      <p><a href="/">Back</a></p>
    </div>
    <script src="/static/script.js"></script>
  </body>
</html>
